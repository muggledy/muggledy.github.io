"use strict";var IssuesAPI={requestIssuesAPI:function(a,r,o){var l=10;!function n(){return new Promise(function(s,e){var t=0,i=setTimeout(function(){0===t&&(t=2,i=null,e("请求超时"),0==l&&o())},5e3);fetch(a).then(function(e){if(2!==t&&(clearTimeout(i),s(e),i=null,t=1),e.ok)return e.json();throw new Error("Network response was not ok.")}).then(function(e){l=0,r(e)}).catch(function(e){0<l?(--l,setTimeout(function(){n()},5e3)):o()})})}()},parseIssueStrToJson:function(e){e=e.match(/```json[\s|\S]*```/);if(e=(e=e&&0<e.length?e[0]:e)&&e.split("```json")[1].split("```")[0])return JSON.parse(e)},groupIssuesData:function(e,s){var t=new Object;if(0<s.length)if(null!=e.group){var n=e.group.split(":");if(1<n.length){var a=n[0],r=n[1];for(a&&r&&(r=r.split(",")),e.group=r,i=0;i<s.length;i++){var o=this.parseIssueStrToJson(s[i].body);if(o&&a in o)for(var l,u=(u=o[a]).replace(", ",",").split(","),c=0;c<u.length;c++)r.includes(u[c])&&((l=null==(l=t[u[c]])?new Array:l).push(o),t[u[c]]=l)}}}else for(e.group=[""],i=0;i<s.length;i++){var d,p=this.parseIssueStrToJson(s[i].body);p&&((d=null==(d=t[""])?new Array:d).push(p),t[""]=d)}return t},getIssuesAPIForSites:function(s){var l=$(s.el)[0];$(l).append('<div class="loading"><i class="fa fa-cog fa-2x fa-spin"></i><p>正在加载...</p></div>'),this.requestIssuesAPI(s.api,function(e){$(l).find(".loading").remove();var r=IssuesAPI.groupIssuesData(s,e),o=Object.keys(r);s.group.forEach(function(e,s){var t=r[e];if(t&&0<t.length)for(0<e.length?$(l).append("<h2>"+e+"</h2>"):""==name&&1<o.length&&$(l).append("<h2>未分组</h2>"),$(l).append('<div class="site-card-group '+s+'"></div>'),j=0;j<t.length;j++){var i=t[j],n="",n=i.screenshot&&0<i.screenshot.length?'<div class="img"><img src="'+i.screenshot+'" onerror="this.onerror=null,this.src=\'https://cdn.statically.io/gh/celestezj/ImageHosting/master/img/20210328224519.jpg\'"/></div>':'<div class="img"></div>',a='<div class="info">';i.avatar&&0<i.avatar.length&&(a+='<img src="'+i.avatar+'" onerror="this.onerror=null,this.src=\'https://cdn.statically.io/gh/celestezj/ImageHosting/master/img/20210328224511.gif\'"/>'),a+='<span class="title">'+i.title+'</span><span class="desc">'+i.description+"</span></div>";a="<a class='site-card' target='_blank' href='"+i.url+"'>"+n+a+"</a>";$(l).find(".site-card-group."+s).append(a)}}),document.getElementById("ghfriendsnote").style.display="inline"},function(){$(l).find(".loading i").remove(),$(l).find(".loading p").text("加载失败，请稍后重试。")})},getIssuesAPIForTimeline:function(e){var t=$(e.el)[0];$(t).append('<div class="loading"><i class="fa fa-cog fa-2x fa-spin"></i><p>正在加载...</p></div>'),this.requestIssuesAPI(e.api,function(e){if($(t).find(".loading").remove(),0<e.length)for(i=0;i<e.length;i++){var s='&nbsp;&nbsp;<a class="comments" target="_blank" href="'+e[i].html_url+'"><i class="fa fa-comment-dots fa-fw"></i>'+e[i].comments+"</a>",s='<div class="timenode">'+('<div class="meta"><p></p><p>'+e[i].title+s+"</p><p></p></div>")+('<div class="body"><p>'+e[i].body+"</p></div>")+"</div>";$(t).append(s)}},function(){$(t).find(".loading i").remove(),$(t).find(".loading p").text("加载失败，请稍后重试。")})},request:function(){for(var e=document.getElementsByClassName("issues-api"),s=0;s<e.length;s++){var t=e[s],i=t.getAttribute("api"),n=t.getAttribute("group"),a=new Object;a.class=t.getAttribute("class"),a.el=t,a.api=i,a.group=n,a.class.split(" ").includes("sites")?this.getIssuesAPIForSites(a):a.class.split(" ").includes("timeline")&&this.getIssuesAPIForTimeline(a)}}};function request_issue(){IssuesAPI.request()}"undefined"!=typeof btf?btf.isJqueryLoad(request_issue):window.attachEvent?window.attachEvent("onload",function(){btf.isJqueryLoad(request_issue)}):window.addEventListener("load",function(){btf.isJqueryLoad(request_issue)},!0),document.addEventListener("pjax:complete",function(){request_issue()});