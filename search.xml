<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>魔改部分记录</title>
      <link href="posts/65257/"/>
      <url>posts/65257/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><ul><li>按照<a href="https://butterfly.lete114.top/article/Butterfly-config.html">Lete乐特</a>的教程添加了哔哩哔哩banner，用以替换原始顶图（Top image）<br>这导致banner图不适应暗黑模式，问题就是如何将banner所在div调暗，现有两种解决方案（我采取第二种）：<ol><li>通过亮度滤镜实现<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#page-header</span> &#123;</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">brightness</span>(<span class="number">60%</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>实测发现，每当从暗黑模式进入新的页面，顶图变暗都有一个很大的延迟，我没有找出具体的原因，因此想了另一个解决方案，通过伪元素实现（黑色透明蒙板）遮罩层：</li><li>通过伪元素实现<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#page-header</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>:<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">display</span>:block;</span><br><span class="line">    <span class="attribute">position</span>:relative;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">z-index</span>:<span class="number">7</span>;</span><br><span class="line">    <span class="attribute">background-color</span>:<span class="number">#121212</span>;</span><br><span class="line">    <span class="attribute">opacity</span>:<span class="number">0.7</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>注：目前博客已去除哔哩哔哩banner</li><li>之前看到<a href="https://www.heson10.com/">黑石博客</a>首页文章卡片有模糊背景，很漂亮，我也来实现一下吧<br>首先看一个实现该效果的简单示例：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line">  .wrapper&#123;</span><br><span class="line"><span class="css">      <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="css">      <span class="attribute">width</span>:<span class="number">500px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">height</span>:<span class="number">400px</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line">  .blur_layer&#123;</span><br><span class="line"><span class="css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="css">      <span class="attribute">width</span>:<span class="number">100%</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">height</span>:<span class="number">100%</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">8px</span>);</span></span><br><span class="line"><span class="css">      <span class="attribute">background</span>:<span class="built_in">url</span>(<span class="string">https://cdn.jsdelivr.net/gh/celestezj/ImageHosting/img/20210217120300.jpg</span>);</span></span><br><span class="line"><span class="css">      <span class="attribute">background-size</span>: cover;</span></span><br><span class="line"><span class="css">      <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line">  .content&#123;</span><br><span class="line"><span class="css">      <span class="attribute">position</span>:absolute;</span></span><br><span class="line"><span class="css">      <span class="attribute">left</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">top</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>);</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;blur_layer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">        Hello, World!<span class="comment">&lt;!-- 这里放置你的内容 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>简单来说就是将父div设为relative，然后额外添加一个子div充当blur层并设为absolute，在blur层上设置背景并进行高斯模糊，最后将你要显示在blur层之上的东西都放在blur层后面即可<br>好了，思路有了，现在改源码，打开目标文件<em>butterfly/layout/includes/mixins/post-ui.pug</em>，在<code>if post_cover &amp;&amp; theme.cover.index_enable</code>一行下面添加如下内容：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.dyblurbg</span><br><span class="line">  if theme.lazyload.enable</span><br><span class="line">    img(data-lazy-src&#x3D;url_for(post_cover) onerror&#x3D;&#96;this.onerror&#x3D;null;this.src&#x3D;&#39;&#96;+ url_for(theme.error_img.post_page) + &#96;&#39;&#96; alt&#x3D;title)</span><br><span class="line">  else</span><br><span class="line">    img(src&#x3D;url_for(post_cover))</span><br></pre></td></tr></table></figure>这个<code>.dyblurbg</code>就是充当blur层的div，类名叫做<code>dyblurbg</code>，为了适配主题源码，还需要增加是否图片懒加载的判断，具体参见<a href="https://www.npmjs.com/package/vanilla-lazyload">vanilla-lazyload</a><br>新建<em>butterfly/source/css/mystyle.css</em>文件：<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.dyblurbg</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">15px</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.dyblurbg</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.recent-post-item</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>其中<code>recent-post-item</code>就是<code>dyblurbg</code>的父div，最后在主题配置的<code>inject</code>项中引入该css文件即可：<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/css/mystyle.css&quot;&gt;</span></span><br></pre></td></tr></table></figure><div class="note danger flat"><p>经过测试，在PC端、手机端各浏览器都工作正常，唯独在iPad设备中背景模糊特效图片会时不时发生闪烁且残缺不全的状况，暂时无力解决，慎用</p></div>解决不了问题那就消除问题好了，在移动端，我直接将blur层给置为<code>none</code>了😅<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">1500px</span>)&#123;</span><br><span class="line">    <span class="selector-class">.dyblurbg</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>之前在Volantis主题中根据<a href="https://cloud.tencent.com/developer/article/1597223">参考文章</a>增加了文章日历图，稍稍改一点应用到Butterfly主题下<div class="btns rounded center dy">            <a class="button" href='https://cdn.jsdelivr.net/gh/celestezj/ImageHosting/download/post-calendar.pug' title='下载资源'><i class='fas fa-download'></i>下载资源</a>          </div><ol><li>将下载下来的源码文件（<em>post-calendar.pug</em>）粘贴到<i>themes/butterfly/layout/includes/</i>目录下</li><li>在<em>themes/butterfly/source/css/mystyle.css</em>中添加样式：<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="selector-id">#post-calendar</span> &#123;</span><br><span class="line">     <span class="attribute">height</span>: <span class="number">225px</span>;</span><br><span class="line">     <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">     <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span><br><span class="line">     <span class="attribute">border-radius</span>: <span class="number">12px</span>;</span><br><span class="line">     <span class="attribute">background</span>:<span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>在<em>themes/butterfly/layout/archive.pug</em>中引入<em>post-calendar.pug</em>，在<code>#archive</code>位置下插入一行：<code>include includes/post-calendar</code>，注意空格，如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">#archive</span><br><span class="line">  include includes&#x2F;post-calendar</span><br><span class="line">  .article-sort-title&#x3D; _p(&#39;page.articles&#39;) + &#39; - &#39; + site.posts.length</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li>在主题配置文件（<em>_config.butterfly.yml</em>）中<code>inject</code>项中引入依赖文件：<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="string">...</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/css/mystyle.css&quot;&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;http://cdn.staticfile.org/moment.js/2.24.0/moment.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;https://cdn.jsdelivr.net/gh/InfiniteYinux/cloud@2.44/Hexo/themeConfig/echarts.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line">    <span class="string">...</span></span><br></pre></td></tr></table></figure></li></ol>注：目前本博客已去除文章日历，示例可参见：<s><a href="https://celestezj.github.io/archives/">https://celestezj.github.io/archives/</a></s></li><li>对相关文章的样式进行了修改（似乎比原来美观了那么一点点，或者还是丑陋~），目前只在电脑端体验<br>注：不需要修改主题源文件，只需要在<em>butterfly/source/css/mystyle.css</em>中添加即可<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>: <span class="number">1500px</span>)&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.relatedPosts</span> &gt; <span class="selector-class">.relatedPosts-list</span> <span class="selector-tag">div</span> &#123;</span><br><span class="line">      <span class="attribute">background</span>: <span class="number">#f6f6f6</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.relatedPosts</span>&#123;</span><br><span class="line">      <span class="attribute">background</span>: <span class="number">#121212</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.relatedPosts</span> &gt; <span class="selector-class">.relatedPosts-list</span> <span class="selector-tag">div</span>&#123;</span><br><span class="line">      <span class="attribute">background</span>: <span class="number">#121212</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.relatedPosts</span> &gt; <span class="selector-class">.relatedPosts-list</span> <span class="selector-class">.cover</span> &#123;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">66%</span>;</span><br><span class="line">      <span class="attribute">opacity</span>: <span class="number">0.8</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.relatedPosts</span> &gt; <span class="selector-class">.relatedPosts-list</span> <span class="selector-class">.content</span> &#123;</span><br><span class="line">      <span class="attribute">top</span>: <span class="number">85%</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.relatedPosts</span> &gt; <span class="selector-class">.relatedPosts-list</span> <span class="selector-class">.content</span> <span class="selector-class">.title</span>, <span class="selector-class">.date</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="number">#888888</span> <span class="meta">!important</span>;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="number">0.82rem</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.relatedPosts</span> &gt; <span class="selector-class">.relatedPosts-list</span> <span class="selector-class">.content</span> <span class="selector-class">.title</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="number">#656261</span> <span class="meta">!important</span>;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">      <span class="attribute">display</span>: block;</span><br><span class="line">      <span class="attribute">overflow</span>:hidden;</span><br><span class="line">      <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">      <span class="attribute">text-overflow</span>:ellipsis;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.relatedPosts</span> &gt; <span class="selector-class">.relatedPosts-list</span> <span class="selector-class">.content</span> <span class="selector-class">.title</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: red <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.relatedPosts</span> &#123;</span><br><span class="line">      <span class="attribute">background</span>: <span class="number">#f6f6f6</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.relatedPosts</span> &gt; <span class="selector-class">.relatedPosts-list</span> &#123;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">94%</span> <span class="meta">!important</span>;</span><br><span class="line">      <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">215px</span>;</span><br><span class="line">      <span class="attribute">overflow</span>: scroll;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.relatedPosts</span> &gt; <span class="selector-class">.headline</span> &#123;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="number">1.1em</span>;</span><br><span class="line">      <span class="attribute">margin-left</span>: <span class="number">3%</span>;</span><br><span class="line">      <span class="attribute">padding-top</span>: <span class="number">14.5px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.relatedPosts</span> &gt; <span class="selector-class">.headline</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="number">#b8b8b8</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ::-webkit-scrollbar &#123;</span><br><span class="line">      width: <span class="number">5px</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ::-webkit-scrollbar-corner &#123;</span><br><span class="line">      background-color: <span class="number">#f6f6f6</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> ::-webkit-scrollbar-corner &#123;</span><br><span class="line">      background-color: <span class="number">#121212</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>为存档、分类、标签页面的文章列表中的头图添加大图预览<ol><li>新建<i>themes/butterfly/source/js/article_img_preview.js</i>文件：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.imagePreview = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  xOffset = <span class="number">10</span>;</span><br><span class="line">  yOffset = <span class="number">30</span>;</span><br><span class="line">  $(<span class="string">&quot;a.article-sort-item-img&quot;</span>).hover(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">     <span class="built_in">this</span>.t = <span class="built_in">this</span>.title;</span><br><span class="line">     <span class="keyword">var</span> c = (<span class="built_in">this</span>.t != <span class="string">&quot;&quot;</span>) ? <span class="string">&quot;&lt;br/&gt;&quot;</span> + <span class="built_in">this</span>.t : <span class="string">&quot;&quot;</span>;</span><br><span class="line">     $(<span class="string">&quot;body&quot;</span>).append(<span class="string">&quot;&lt;div id=&#x27;article-img-preview&#x27;&gt;&lt;img src=&#x27;&quot;</span>+ $(<span class="built_in">this</span>).find(<span class="string">&#x27;img&#x27;</span>).attr(<span class="string">&#x27;src&#x27;</span>) +<span class="string">&quot;&#x27; alt=&#x27;Article Image Preview&#x27; style=&#x27;width:300px;&#x27; /&gt;&quot;</span>+ c +<span class="string">&quot;&lt;/div&gt;&quot;</span>);</span><br><span class="line">     $(<span class="string">&quot;#article-img-preview&quot;</span>)</span><br><span class="line">         .css(<span class="string">&quot;top&quot;</span>,(e.pageY - xOffset) + <span class="string">&quot;px&quot;</span>)</span><br><span class="line">         .css(<span class="string">&quot;left&quot;</span>,(e.pageX + yOffset) + <span class="string">&quot;px&quot;</span>)</span><br><span class="line">         .fadeIn(<span class="string">&quot;fast&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     $(<span class="string">&quot;#article-img-preview&quot;</span>).remove();</span><br><span class="line">  &#125;);</span><br><span class="line">  $(<span class="string">&quot;a.article-sort-item-img&quot;</span>).mousemove(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">     $(<span class="string">&quot;#article-img-preview&quot;</span>)</span><br><span class="line">         .css(<span class="string">&quot;top&quot;</span>,(e.pageY - xOffset) + <span class="string">&quot;px&quot;</span>)</span><br><span class="line">         .css(<span class="string">&quot;left&quot;</span>,(e.pageX + yOffset) + <span class="string">&quot;px&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// starting the script on page load</span></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  imagePreview();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li>在<i>themes/butterfly/source/css/mystyle.css</i>中添加预览图所在div样式：<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#article-img-preview</span>&#123;</span><br><span class="line">  <span class="attribute">position</span>:absolute;</span><br><span class="line">  <span class="attribute">background</span>:<span class="number">#333</span>;</span><br><span class="line">  <span class="attribute">padding</span>:<span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">display</span>:none;</span><br><span class="line">  <span class="attribute">color</span>:<span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>在主题配置文件的<code>inject</code>项中引入上述脚本以及jQuery库：<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">inject:</span><br><span class="line">  head:</span><br><span class="line"><span class="code">    ...</span></span><br><span class="line"><span class="code">    - &lt;script src=&quot;https://cdn.staticfile.org/jquery/2.1.4/jquery.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="code">    - &lt;script src=&quot;/js/article_img_preview.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="code">    ...</span></span><br></pre></td></tr></table></figure></li></ol>好了，这就OK了，无需修改任何其他主题源码<br>考虑到大部分人都会在主题配置中启用pjax，下面给出（在上述基础上）适配pjax的修改版本<blockquote><p>使用pjax后，一些用户自定义的js脚本在页面跳转时可能需要重新调用，参见主题<a href="https://butterfly.js.org/posts/ceeb73f/#Pjax">文档</a><br>将待执行的jquery代码用一个函数包裹起来，然后通过<code>btf.isJqueryLoad(包裹函数)</code>调用以避免多次加载jquery，参见主题<a href="https://butterfly.js.org/posts/4073eda/#jQuery-%E5%8A%A0%E8%BC%89">文档</a></p></blockquote><ol><li>删除主题配置<code>inject</code>项中<code>jquery.min.js</code>的引用</li><li>替换<i>themes/butterfly/source/js/article_img_preview.js</i>文件：<a class="btn-beautify button--animated purple" href="https://cdn.jsdelivr.net/gh/celestezj/ImageHosting@v0.9/data/img_preview/article_img_preview.js"   title="下载"><i class="far fa-hand-point-right faa-horizontal animated fa-fw"></i><span>下载</span></a></li><li>修改<i>themes/butterfly/layout/includes/layout.pug</i>文件，在最后一行添加（注意空格，script打头空两格）：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">script(data-pjax).</span><br><span class="line">  btf.isJqueryLoad(image_preview_wrapper);</span><br></pre></td></tr></table></figure></li></ol></li></ul>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Butterfly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo博客简易配置</title>
      <link href="posts/17177/"/>
      <url>posts/17177/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="note blue icon flat"><i class="note-icon fas fa-quote-left"></i><p><a href="https://hexo.io/zh-cn/docs/">Hexo</a> 是一个快速、简洁且高效的博客框架。Hexo 使用 <a href="https://daringfireball.net/projects/markdown/">Markdown</a>（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。</p></div><span id="more"></span><h2 id="环境初始化">环境初始化</h2><p>以<i>Windows</i>环境为例</p><ol><li><p>安装<i>git</i></p></li><li><p>安装<i>nodejs</i>（通过<i>nvm</i>安装）</p><ul><li><p>安装<i>nvm</i></p><p>下载<i><a href="https://github.com/coreybutler/nvm-windows/releases">nvm-noinstall.zip</a></i>并解压，设路径为<i>path/nvm/</i>，以管理员身份运行其中的<i>install.cmd</i>，编辑生成的<i>path/nvm/settings.txt</i>文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root: path&#x2F;nvm</span><br><span class="line">path: path&#x2F;nodejs #不存在该目录，但不用管</span><br><span class="line">arch: 64</span><br><span class="line">proxy: none</span><br><span class="line">node_mirror: http:&#x2F;&#x2F;npm.taobao.org&#x2F;mirrors&#x2F;node&#x2F;</span><br><span class="line">npm_mirror: https:&#x2F;&#x2F;npm.taobao.org&#x2F;mirrors&#x2F;npm&#x2F;</span><br></pre></td></tr></table></figure><p>此时系统环境变量会新增两项：<code>NVM_HOME</code>和<code>NVM_SYMLINK</code>，修改<code>NVM_HOME</code>值为<i>path/nvm</i>，<code>NVM_SYMLINK</code>值为<i>path/nodejs</i>，并添加到<code>PATH</code>变量中：<i>%NVM_HOME%;%NVM_SYMLINK%;</i></p><p>打开<i>cmd</i>命令窗口，输入<code>nvm v</code>查看配置是否正确</p></li><li><p>在命令窗口中输入<code>nvm install latest</code>安装最新的<i>nodejs</i>版本（包括局部<i>npm</i>），随后通过<code>nvm use 版本号</code>选择要使用的版本（可以通过<code>nvm ls</code>查看当前安装的所有<i>nodejs</i>版本）</p></li><li><p>安装全局<i>npm</i>（可选）</p><p>首先执行<code>npm config set prefix &quot;/path/nvm/npm&quot;</code>配置<i>npm</i>的全局安装路径，会生成一个<i>.npmrc</i>文件（默认在<i>C</i>盘用户文件夹下），其中的内容就是<i>path/nvm/npm</i>，然后执行<code>npm install npm -g</code>安装全局<i>npm</i>，注意这个<code>-g</code>参数。在系统中新建环境变量<code>NPM_HOME</code>，值为<i>path/nvm/npm</i>，并将<code>%NPM_HOME%</code>添加到<code>PATH</code>变量中（注意要放在<code>%NVM_SYMLINK%</code>前面），执行<code>npm -v</code>查看配置是否正确</p></li><li><p>安装<i>cnpm</i>（可选）</p><p>配置国内镜像以加速，执行<code>npm install -g cnpm --registry=http://r.cnpmjs.org</code>命令安装，之后就可以用<code>cnpm install 包名</code>来代替<code>npm install 包名</code>了</p></li></ul></li><li><p>安装<i>Hexo</i></p><p>执行命令<code>cnpm install -g hexo-cli</code></p></li><li><p>建站</p><ul><li><p>创建个人博客文件夹，设路径为<i>path/myblog/</i>，初始化博客文件夹：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /path/myblog/ #之后的所有命令都要先cd进入博客根目录，不再赘述</span><br><span class="line">hexo init</span><br></pre></td></tr></table></figure><p>初始化后得到一个<i>package.json</i>文件（描述了项目所依赖的包），然后再执行<code>cnpm install</code>安装相关依赖</p></li><li><p>生成静态网页，并在本地发布</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo generate</span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure><p>最后通过地址&quot;<i><a href="http://localhost:4000">http://localhost:4000</a></i>&quot;即可访问</p></li></ul></li></ol><h2 id="基本配置">基本配置</h2><p>选择某个现成的<a href="https://hexo.io/themes">主题</a>，一般下载后放到博客根目录下的主题文件夹中，即<i>myblog/themes/</i>，<i>Hexo</i>将会根据主题来生成静态页面。以<a href="https://github.com/Molunerfinn/hexo-theme-melody">Melody</a>主题为例，根据其说明文档一步一步进行配置，且该主题可以直接通过<code>cnpm install --save hexo-theme-melody</code>命令安装（放在<i>myblog/node_modules/</i>目录下）</p><ul><li><p><i>LaTex</i>支持</p><p>说明文档有所遗漏，再细说一下，先安装<i>Kramed</i>，同时卸载掉默认的渲染引擎<i>marked</i>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cnpm uninstall hexo-renderer-marked --save</span><br><span class="line">cnpm install hexo-renderer-kramed --save</span><br></pre></td></tr></table></figure><p>再修改<i>melody.yml</i>主题配置文件：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mathjax:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">cdn:</span> <span class="string">https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML</span></span><br></pre></td></tr></table></figure><p>由于<i>LaTeX</i>与<i>markdown</i>语法存在语义冲突，所以还需要对默认的转义规则进行修改，修改<i>myblog/node_modules/kramed/lib/rules/inline.js</i>中的两处内容：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">escape</span>: <span class="regexp">/^\\([`*\[\]()# +\-.!_&gt;])/</span>, <span class="comment">//替换：escape: /^\\([\\`*&#123;&#125;\[\]()#$+\-.!_&gt;])/,</span></span><br><span class="line">em: <span class="regexp">/^\*((?:\*\*|[\s\S])+?)\*(?!\*)/</span>, <span class="comment">//替换：em: /^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,</span></span><br></pre></td></tr></table></figure><p>注意，由于<i>node_modules</i>文件夹不会被<i>git</i>跟踪（该项位于<i>.gitignore</i>中），因此在博客迁移后需要重新配置（所以应尽量避免修改<i>node_modules</i>文件夹中的内容以减少麻烦）</p></li><li><p>部署到<i>GitHub Page</i></p><p>在<i>GitHub</i>上新建仓库，命名为：<i>用户名.github.io</i>，再修改<i>_config.yml</i>文件：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">git@github.com:用户名/用户名.github.io</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><p>注意，如果本地添加了多个<i>GitHub</i>账号的密钥，应根据<i>~/.ssh/config</i>文件修改上述<i>repo</i>地址为：<i>Host:用户名/用户名.github.io</i>，最后执行部署：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d //和上一条命令可以合并为：hexo g -d，如果报错：ERROR Deployer not found: git，先执行：cnpm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p>部署成功后，通过地址&quot;<i><a href="https://xn--eqr924avxo.github.io">https://用户名.github.io</a></i>&quot;即可访问博客</p></li><li><p>博客迁移和同步管理</p><ul><li>在本地博客根目录<i>myblog/</i>下执行<code>git init</code>初始化仓库，以对魔改的主题和配置文件（简称为环境数据）进行版本控制，再添加远程仓库关联：<code>git remote add origin git@github.com:用户名/用户仓库.git</code>，最后执行<code>git push origin master</code>同步本地环境数据到远程仓库（的master主分支）即可，如果要推送到远程仓库的其他指定分支（可以不存在），则执行<code>git push origin master:指定远程仓库分支名</code>（参考<a href="https://www.processon.com/view/link/6072e58af346fb70967913f7">git</a>思维导图）</li><li>现在迁移博客到其他电脑设备是很容易的，首先环境初始化（安装<i>git</i>、<i>nodejs</i>和<i>Hexo</i>），然后克隆上述远程仓库（的主分支）至本地：<code>git clone git@github.com:用户名/用户仓库.git</code>（也可以克隆仓库下的指定分支，<code>git clone -b 指定分支 git@github.com:用户名/用户仓库.git</code>），再根据<i>packge.json</i>安装依赖，最后<code>hexo g</code>、<code>hexo s</code>就能在本地重新打开博客了</li></ul></li><li><p><i>Algolia</i>搜索</p><p>首先注册<a href="https://www.algolia.com/"><i>Algolia</i></a>账户，新建<i>index</i>，并获取<i>Application ID</i>、<i>Search-Only API Key</i>、<i>Admin API Key</i>，然后执行<code>cnpm install --save hexo-algolia</code>，并配置<i>_config.yml</i>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">algolia:</span></span><br><span class="line">  <span class="attr">applicationID:</span> <span class="string">&#x27;application id&#x27;</span></span><br><span class="line">  <span class="attr">apiKey:</span> <span class="string">&#x27;search-only api Key&#x27;</span></span><br><span class="line">  <span class="attr">indexName:</span> <span class="string">&#x27;index name&#x27;</span></span><br></pre></td></tr></table></figure><p>再配置<i>melody.yml</i>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">algolia_search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># or false</span></span><br><span class="line">  <span class="attr">hits:</span></span><br><span class="line">    <span class="attr">per_page:</span> <span class="number">10</span> <span class="comment"># the number of search results per page</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">input_placeholder:</span> <span class="string">Search</span> <span class="string">for</span> <span class="string">Posts</span></span><br><span class="line">    <span class="attr">hits_empty:</span> <span class="string">&quot;We didn&#x27;t find any results for the search: $&#123;query&#125;&quot;</span> <span class="comment"># if there are no result</span></span><br><span class="line">    <span class="attr">hits_stats:</span> <span class="string">&quot;$&#123;hits&#125; results found in $&#123;time&#125; ms&quot;</span></span><br></pre></td></tr></table></figure><p>最后执行<code>hexo algolia</code>生成索引文件并上传到<i>Algolia</i>服务器，出错：<i>ERROR [hexo-algolia] Please set an HEXO_ALGOLIA_INDEXING_KEY environment variable to enable content indexing. ERROR &gt;&gt; Read <a href="https://npmjs.com/hexo-algolia#api-key">https://npmjs.com/hexo-algolia#api-key</a> for more informations</i>，根据提示，直接在当前<i>cmd</i>中创建该环境变量（重启窗口会失效，建议“<i>此电脑右键-属性-高级系统设置-环境变量</i>”，博客迁移后注意要重新配置）：<code>set HEXO_ALGOLIA_INDEXING_KEY=admin api key</code>，重新执行<code>hexo algolia</code>，成功</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
